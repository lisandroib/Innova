version: "3.1"

intents:
  - build_cv:
      use_entities: false
  - modify_cv:
      use_entities: false
  - affirm_phone:
      use_entities: false
  - deny_phone:
      use_entities: false
  - inform
  - affirm # --- CAMBIO 1: AÑADIDO (necesario para LinkedIn)
  - deny # --- CAMBIO 1: AÑADIDO (necesario para LinkedIn)

entities:
  - education_level

slots:
  # --- CAMBIO 2: AÑADIDOS "conditions" A TODOS LOS SLOTS "from_text" ---

  full_name:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent:
          &base_not_intent # <-- Esto es un "ancla" de YAML para no repetir
          - build_cv
          - modify_cv
          - affirm_phone
          - deny_phone
          - inform
          - affirm
          - deny

  birth_date:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent: *base_not_intent # <-- Reutiliza la lista

  city:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent: *base_not_intent

  timezone:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent: *base_not_intent

  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent: *base_not_intent

  wants_phone:
    type: bool
    influence_conversation: false
    mappings:
      - type: custom

  phone_number:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent: *base_not_intent

  wants_linkedin:
    type: bool
    influence_conversation: false
    mappings:
      - type: custom

  linkedin_profile:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: cv_form
        not_intent: *base_not_intent

  education_level:
    type: categorical
    values:
      - sec_incompleto
      - sec_completo
      - curs_grado
      - curs_terciario
      - grad_grados # <-- (Ojo, creo que aquí quisiste poner "grad_grado")
      - grad_terciario
      - posgrado
    mappings:
      - type: from_entity
        entity: education_level

responses:
  # --- ARREGLO 1: Cambia esta respuesta ---
  utter_ask_initial_choice:
    - text: "El bot pregunta:" #
      buttons:
        - title: "Si tenemos un cv" #
          payload: /modify_cv
        - title: "Queremos armar uno desde cero" #
          payload: /build_cv

  # --- ARREGLO 2: Agrega esta nueva respuesta ---
  utter_ask_for_file_upload:
    - text: "Por favor suba el archivo a continuación" #

  # Estas son las preguntas que el FORM usará
  utter_ask_full_name:
    - text: "¡Perfecto! Comencemos. ¿Cuál es tu nombre completo?"

  utter_ask_birth_date:
    - text: "¿Cuál es tu fecha de nacimiento? (Ej. 15/03/1990)"

  utter_ask_city:
    - text: "¿En qué ciudad resides actualmente?"

  utter_ask_timezone:
    - text: "¿Cuál es tu zona horaria? (Ej. GMT-3)"

  utter_ask_email:
    - text: "Necesitaré tu email para que las empresas te contacten."

  utter_ask_wants_phone:
    - text: "¿Quieres agregar un número de teléfono de contacto?"
      buttons:
        - title: "Sí"
          payload: /affirm_phone
        - title: "No"
          payload: /deny_phone

  utter_ask_phone_number:
    - text: "Entendido. ¿Cuál es tu número de teléfono?"

  utter_ask_wants_linkedin:
    - text: "¿Quieres agregar tu perfil de LinkedIn?"
      buttons:
        - title: "Sí"
          payload: /affirm # <-- Ahora esto funcionará
        - title: "No"
          payload: /deny # <-- Ahora esto funcionará

  utter_ask_linkedin_profile:
    - text: "Genial, ¿cuál es la URL de tu perfil de LinkedIn?"

  # --- Respuestas del Flujo "Modificar CV" ---
  utter_ask_education_level:
    - text: "Hablemos de tu educación. ¿Cuál es tu nivel máximo alcanzado?"
      buttons:
        - title: "Secundario incompleto"
          payload: '/inform{"education_level": "sec_incompleto"}'
        - title: "Secundario completo"
          payload: '/inform{"education_level": "sec_completo"}'
        - title: "Cursando carrera de grado"
          payload: '/inform{"education_level": "curs_grado"}'
        - title: "Cursando terciario"
          payload: '/inform{"education_level": "curs_terciario"}'
        - title: "Graduado carrera"
          payload: '/inform{"education_level": "grad_grado"}'
        - title: "Graduado Terciario"
          payload: '/inform{"education_level": "grad_terciario"}'
        - title: "Posgrado"
          payload: '/inform{"education_level": "posgrado"}'

  utter_ask_soft_skills:
    - text: "Hablemos de habilidades blandas. (Aquí pondrías las opciones...)"

  utter_submit_cv_form:
    - text: "¡Genial! Hemos completado tu información básica."

# --- Declaración del Form ---
forms:
  cv_form:
    # --- CAMBIO 3: ELIMINADA LA LISTA "required_slots" ---
    # Dejamos que "actions.py" (con la función required_slots)
    # controle esto al 100%.
    
    required_slots: []

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

# --- Declaración de Acciones ---
actions:
  - validate_cv_form
